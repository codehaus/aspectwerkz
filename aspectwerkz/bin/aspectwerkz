#!/bin/sh

# ----------------------------------------------------------------------------------
# Copyright (c) The AspectWerkz Team. All rights reserved.
# http://aspectwerkz.codehaus.org
# ----------------------------------------------------------------------------------
# The software in this package is published under the terms of the BSD style license
# a copy of which has been included with this distribution in the license.txt file.
# ----------------------------------------------------------------------------------

ASPECTWERKZ_VERSION=0.7.4
ASPECTWERKZ_LIBS=$ASPECTWERKZ_HOME/lib/dom4j-1.4.jar:$ASPECTWERKZ_HOME/lib/qdox-1.2.jar:$ASPECTWERKZ_HOME/lib/concurrent-1.3.1.jar:$ASPECTWERKZ_HOME/lib/trove-1.0.2.jar:$ASPECTWERKZ_HOME/lib/commons-jexl-1.0-beta-2.jar:$ASPECTWERKZ_HOME/lib/piccolo-1.03.jar:$ASPECTWERKZ_HOME/lib/jrexx-1.1.1.jar:$ASPECTWERKZ_HOME/config

usage() {
	if [ -z "$ASPECTWERKZ_HOME" ]; then
		echo "Please specify the ASPECTWERKZ_HOME environment variable"
	else
		if [ -r "$ASPECTWERKZ_HOME/config/usage.txt" ]
		then
			cat "$ASPECTWERKZ_HOME/config/usage.txt"
		else
			echo "ASPECTWERKZ_HOME does not point to the aspectwerkz distribution"
		fi
	fi
	exit 1
}

if [ -z "$1" -o -z "$ASPECTWERKZ_HOME" ]; then
	usage
fi
if [ -z "$JAVA_HOME" ]; then
    echo Please specify the JAVA_HOME environment variable
    exit 1;
fi
if [ -z "$CLASSPATH" ]; then
	CLASSPATH="."
fi
if [ -z "$JAVA_COMMAND" ]; then
	JAVA_COMMAND="java"
fi

if [ "$1" != "-offline" ]; then
    $JAVA_COMMAND -cp $JAVA_HOME/lib/tools.jar:$ASPECTWERKZ_HOME/lib/bcel.jar:$ASPECTWERKZ_HOME/lib/aspectwerkz-core-$ASPECTWERKZ_VERSION.jar org.codehaus.aspectwerkz.hook.ProcessStarter -Daspectwerkz.classloader.preprocessor=org.codehaus.aspectwerkz.transform.AspectWerkzPreProcessor -Xbootclasspath/p:"$ASPECTWERKZ_HOME/lib/bcel-patch.jar:$ASPECTWERKZ_HOME/lib/bcel.jar:$ASPECTWERKZ_HOME/lib/aspectwerkz-core-$ASPECTWERKZ_VERSION.jar" -cp $CLASSPATH -cp $ASPECTWERKZ_HOME/lib/aspectwerkz-$ASPECTWERKZ_VERSION.jar:$ASPECTWERKZ_LIBS -Daspectwerkz.home=$ASPECTWERKZ_HOME $@
else
    if [ "$#" < 3 ]; then
        usage
    fi
    $JAVA_COMMAND -Daspectwerkz.definition.file=$3 -Daspectwerkz.metadata.dir=$4 -Daspectwerkz.home=$ASPECTWERKZ_HOME -cp $ASPECTWERKZ_HOME/lib/aspectwerkz-$ASPECTWERKZ_VERSION.jar:$ASPECTWERKZ_LIBS:$ASPECTWERKZ_HOME/lib/bcel.jar org.codehaus.aspectwerkz.compiler.AspectWerkzC -verbose org.codehaus.aspectwerkz.transform.AspectWerkzPreProcessor $2
fi

