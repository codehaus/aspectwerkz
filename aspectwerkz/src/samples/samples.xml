<?xml version="1.0"?>

<aspectwerkz>

    <advice-def name="invocation_counter"
        advice="examples.caching.InvocationCounterAdvice"
        deployment-model="perInstance"
        attribute="invocation_counter"/>

    <advice-def name="cache"
        class="examples.caching.CachingAdvice"
        deployment-model="perInstance">
        <param name="timeout" value="10"/>
    </advice-def>

    <advice-def name="asynchronous"
        class="examples.asynchronous.AsynchronousAdvice"
        deployment-model="perJVM"/>

    <advice-def name="synchronize"
        class="examples.synchronization.SynchronizationAdvice"
        deployment-model="perJVM"/>

    <advices-def name="cache_stack">
        <advice-ref name="cache"/>
    </advices-def>

    <abstract-aspect name="AbstractSynchronization">
        <advice pointcut="synchronized_calls">
            <advice-ref name="synchronize"/>
        </advice>
    </abstract-aspect>

    <aspect name="Synchronization" extends="AbstractSynchronization">
        <pointcut-def name="synchronized_calls" type="method" pattern="* examples.synchronization.Target.toSynchronize()"/>
    </aspect>

    <aspect name="Caching">
        <pointcut-def name="callee" type="method" pattern="int examples.caching.Pi.getPiDecimal(int)"/>
        <advice pointcut="callee">
            <advices-ref name="cache_stack"/>
        </advice>
    </aspect>      `

    <aspect name="Asynchronous">
        <pointcut-def name="asynchronous_calls" type="method" pattern="* examples.asynchronous.Target.toRunAsynchronously()"/>
        <advice pointcut="asynchronous_calls">
            <advice-ref name="asynchronous"/>
        </advice>
    </aspect>

    <aspect name="Introduction">
        <introduction class="examples.introduction.Target">
            <introduction-ref name="mixin"/>
        </introduction>
    </aspect>


    <!-- ===== TEST ASPECTS BELOW ===== -->

    <!--    <aspect name="CFlow">-->
    <!--        <pointcut-def name="step1" type="cflow" pattern="* examples.cflow.Target.step1()"/>-->
    <!--        <pointcut-def name="step2" type="method" pattern="* examples.cflow.Target.step2()"/>-->
    <!--        <advice cflow="step1" pointcut="step2">-->
    <!--            <advice-ref name="log_control_flow"/>-->
    <!--        </advice>-->
    <!--    </aspect>-->

    <!--    <advice-def name="log" advice="examples.logging.LoggingAdvice" deployment-model="perInstance">-->
    <!--        <param name="param" value="value"/>-->
    <!--    </advice-def>-->
    <!--    <aspect name="Test1" >-->
    <!--        <pointcut-def name="pointcut1" type="method" pattern="* examples.caching.Pi.*(..)"/>-->
    <!--        <advice pointcut="pointcut1">-->
    <!--            <advice-ref name="log"/>-->
    <!--            <advice-ref name="log"/>-->
    <!--            <advice-ref name="cache"/>-->
    <!--        </advice>-->
    <!--    </aspect>-->
    <!--    <aspect name="Test2" >-->
    <!--        <pointcut-def name="pointcut2" type="method" pattern="* examples.caching.Pi.*(..)"/>-->
    <!--        <advice pointcut="pointcut2">-->
    <!--            <advice-ref name="log"/>-->
    <!--            <advice-ref name="log"/>-->
    <!--        </advice>-->
    <!--        <advice pointcut="pointcut2">-->
    <!--            <advice-ref name="log"/>-->
    <!--            <advice-ref name="log"/>-->
    <!--        </advice>-->
    <!--    </aspect>-->

    <advice-def name="log"
        advice="examples.logging.LoggingAdvice"
        deployment-model="perInstance">
        <param name="param" value="value"/>
    </advice-def>
    <aspect name="LogAspect">
        <pointcut-def name="log_pointcut" type="method" pattern="* *.*(..)"/>
        <advice pointcut="log_pointcut">
            <advice-ref name="log"/>
        </advice>
    </aspect>

</aspectwerkz>
